<!doctype html>
<html lang="ja">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1,viewport-fit=cover" />
<title>ä»Šæ—¥ã®æ—¥æ™‚</title>

<style>
/*************************************************
 * ğŸ¨ è‰²ãƒ»ãƒ‡ã‚¶ã‚¤ãƒ³è¨­å®š
 *************************************************/
:root{
  --bg:#000000;

  /* å¹´ */
  --year:#FFFFFF;

  /* æ—¥ä»˜ï¼ˆæ›œæ—¥åˆ¥ï¼‰ */
  --wk:#FFFF00;
  --sat:#5FB3E6;
  --sun:#FF4A4A;

  /* æ™‚åˆ» */
  --time:#00ff00;

  /* ğŸ”Š éŸ³å£°ãƒœã‚¿ãƒ³ */
  --btn-bg:#ff8c00;
  --btn-bg-press:#C96A2C;
  --btn-ring:#C96A2C;
  --btn-disabled:#5A3A28;

  --btn-icon:#FFF1E6;
  --btn-icon-disabled:#D9B9A2;
}

/*************************************************
 * ğŸ§± å…¨ä½“ãƒ¬ã‚¤ã‚¢ã‚¦ãƒˆ
 *************************************************/
html,body{
  height:100%;
  margin:0;
  background:var(--bg);
  font-family:-apple-system,"BIZ UDPGothic","Meiryo",sans-serif;
  overflow:hidden;
}

.wrap{
  height:100%;
  display:flex;
  flex-direction:column;
  justify-content:center;
  align-items:center;
  text-align:center;
  gap:5vh;
  padding:24px;
  box-sizing:border-box;
}

/*************************************************
 * ğŸ”  æ–‡å­—è¡¨ç¤º
 *************************************************/
.yearline{
  color:var(--year);
  font-weight:900;
  font-size:clamp(64px,8vw,130px);
  white-space:nowrap;
}

.dateline{
  font-weight:950;
  font-size:clamp(126.5px,14.95vw,230px); /* 1.15å€ */
  white-space:nowrap;
}

.unit{
  font-size:0.6em;
  margin:0;
}

.timeRow{
  display:flex;
  align-items:center;
  justify-content:center;
  gap:3vw;
  white-space:nowrap;
}

.timeline{
  color:var(--time);
  font-weight:950;
  font-size:clamp(126.5px,14.95vw,230px);
  white-space:nowrap;
  transition:transform 0.3s ease, text-shadow 0.3s ease;
}

/* æ›œæ—¥è‰² */
.wk{color:var(--wk);}
.sat{color:var(--sat);}
.sun{color:var(--sun);}

/*************************************************
 * ğŸ”Š èª­ã¿ä¸Šã’ä¸­ã®å¼·èª¿ï¼ˆæ‹¡å¤§ï¼‹ç™ºå…‰ï¼‰
 *************************************************/
.timeline.reading{
  transform:scale(1.08);
  text-shadow:
    0 0 12px rgba(0,255,0,0.9),
    0 0 24px rgba(0,255,0,0.6);
}

/*************************************************
 * ğŸ”Š éŸ³å£°ãƒœã‚¿ãƒ³
 *************************************************/
.speakBtn{
  width:clamp(126px,12.6vw,198px);
  height:clamp(126px,12.6vw,198px);
  border-radius:9999px;

  border:6px solid var(--btn-ring);
  background:var(--btn-bg);
  color:var(--btn-icon);

  display:flex;
  align-items:center;
  justify-content:center;

  font-size:clamp(63px,6.3vw,108px);
  font-weight:900;

  box-shadow:0 10px 18px rgba(0,0,0,0.45);
  cursor:pointer;
}

.speakBtn:active{
  background:var(--btn-bg-press);
  transform:translateY(4px);
}

.speakBtn[disabled]{
  background:var(--btn-disabled);
  color:var(--btn-icon-disabled);
  border-color:#8C5A3C;
  box-shadow:none;
  cursor:default;
}
</style>
</head>

<body>
<div class="wrap">
  <div class="yearline" id="yearline">----</div>
  <div class="dateline" id="dateline">----</div>

  <div class="timeRow">
    <div class="timeline" id="timeline">--ï¼š--</div>
    <button class="speakBtn" id="speakBtn" onclick="manualSpeak()">ğŸ”Š</button>
  </div>
</div>

<script>
/*************************************************
 * â° æ—¥æ™‚ãƒ­ã‚¸ãƒƒã‚¯
 *************************************************/
const yearEl = document.getElementById("yearline");
const dateEl = document.getElementById("dateline");
const timeEl = document.getElementById("timeline");
const speakBtn = document.getElementById("speakBtn");

const wd = ["æ—¥","æœˆ","ç«","æ°´","æœ¨","é‡‘","åœŸ"];
const AUTO_HOURS = [8,12,18];

let speaking = false;
let lastAutoKey = "";

const pad = n => String(n).padStart(2,"0");

function dayClass(d){
  if(d===0) return "sun";
  if(d===6) return "sat";
  return "wk";
}

function render(){
  const now = new Date();

  yearEl.textContent = `ä»¤å’Œ${now.getFullYear()-2018}å¹´ ${now.getFullYear()}`;

  /* â˜… ç©ºç™½ãŒå‡ºãªã„1è¡Œè¡¨è¨˜ */
  dateEl.innerHTML =
    `<span class="${dayClass(now.getDay())}">${now.getMonth()+1}<span class="unit">æœˆ</span>${now.getDate()}<span class="unit">æ—¥</span>(${wd[now.getDay()]})</span>`;

  timeEl.textContent = `${pad(now.getHours())}ï¼š${pad(now.getMinutes())}`;

  checkAutoSpeak(now);
}

/*************************************************
 * ğŸ”” ãƒãƒ£ãƒ©ãƒ³éŸ³
 *************************************************/
function playChime(){
  const ctx = new (window.AudioContext||window.webkitAudioContext)();
  const t = ctx.currentTime;
  const g = ctx.createGain();
  g.connect(ctx.destination);

  g.gain.setValueAtTime(0.0001,t);
  g.gain.exponentialRampToValueAtTime(0.35,t+0.02);
  g.gain.exponentialRampToValueAtTime(0.0001,t+0.45);

  const o = ctx.createOscillator();
  o.type="triangle";
  o.frequency.setValueAtTime(1200,t);
  o.frequency.exponentialRampToValueAtTime(600,t+0.4);
  o.connect(g);
  o.start();
  o.stop(t+0.45);
}

/*************************************************
 * ğŸ—£ éŸ³å£°èª­ã¿ä¸Šã’
 *************************************************/
function timeGreeting(h){
  if(h===8) return "æœã§ã™ã€‚";
  if(h===12) return "ãŠæ˜¼ã§ã™ã€‚";
  if(h===18) return "å¤•æ–¹ã§ã™ã€‚";
  return "";
}

function buildText(now){
  return `ä»Šæ—¥ã¯${now.getMonth()+1}æœˆ${now.getDate()}æ—¥${wd[now.getDay()]}æ›œæ—¥ã§ã™ã€‚`
       + `æ™‚åˆ»ã¯${now.getHours()}æ™‚${now.getMinutes()}åˆ†ã§ã™ã€‚`
       + `ä»¤å’Œ${now.getFullYear()-2018}å¹´ã€${now.getFullYear()}å¹´ã§ã™ã€‚`;
}

function speak(text){
  if(speaking) return;
  speaking = true;
  speakBtn.disabled = true;

  /* ğŸ”´ èª­ã¿ä¸Šã’é–‹å§‹ï¼šæ™‚åˆ»ã‚’å¼·èª¿ */
  timeEl.classList.add("reading");

  playChime();

  const u = new SpeechSynthesisUtterance(text);
  u.lang="ja-JP";
  u.rate=0.9;
  u.pitch=1.2;

  u.onend=()=>{
    speaking=false;
    speakBtn.disabled=false;
    timeEl.classList.remove("reading");
  };

  speechSynthesis.cancel();
  setTimeout(()=>speechSynthesis.speak(u),450);
}

function manualSpeak(){
  const now = new Date();
  speak(timeGreeting(now.getHours()) + buildText(now));
}

function checkAutoSpeak(now){
  if(now.getMinutes()!==0) return;
  if(!AUTO_HOURS.includes(now.getHours())) return;

  const key = `${now.toDateString()}-${now.getHours()}`;
  if(key===lastAutoKey) return;

  lastAutoKey = key;
  speak(timeGreeting(now.getHours()) + buildText(now));
}

/* åˆæœŸåŒ– & åˆ†æ›´æ–° */
render();
(function tick(){
  const n = new Date();
  setTimeout(()=>{render();tick();},
    (60-n.getSeconds())*1000 - n.getMilliseconds()+30);
})();
</script>
</body>
</html>
