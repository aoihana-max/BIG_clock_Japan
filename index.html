async function runGate(){
  // 連打防止
  if(speaking) return;
  speaking = true;
  gateBtn.disabled = true;

  // ✅ 画面切替は必ず行うための保険
  const forceGoMain = () => {
    ttsReady = true;
    gate.style.display = "none";
    app.style.visibility = "visible";
    render();
  };

  try{
    await ensureAudioContext();
    refreshVoices();

    // ✅ iOS対策：ユーザー操作の“直後”に speak を即実行（awaitを挟まない）
    //   → 診断の「音声テスト」と同じ成功条件に寄せる
    try { speechSynthesis.cancel(); } catch(e) {}
    try { speechSynthesis.resume(); } catch(e) {}

    const u = makeUtterance("テストです。");  // ←確実に通った文言
    u.onend = () => {
      // 読めたら本番へ
      forceGoMain();
    };
    u.onerror = () => {
      // エラーでも本番へ（止まらない）
      forceGoMain();
    };

    // ★ここが最重要：ユーザー操作の文脈内で即 speak
    speechSynthesis.speak(u);

    // ✅ もし iOS が onend/onerror を返さない場合の保険（2.5秒後に必ず切替）
    setTimeout(forceGoMain, 2500);

  } finally {
    speaking = false;
    gateBtn.disabled = false;
  }
}
